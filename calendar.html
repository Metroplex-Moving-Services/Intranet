<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Metroplex Moving Calendar</title>

    <style>
      body {
        margin: 40px 10px;
        padding: 0;
        font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
        font-size: 14px;
      }
      #calendar {
        max-width: 1100px;
        margin: 0 auto;
        height: 85vh; /* Take up 85% of the screen height */
      }
      /* Custom style for the popup links */
      .popup-link {
        color: #3085d6;
        text-decoration: underline;
        font-weight: bold;
        cursor: pointer;
      }
    </style>

    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>

    <div id='calendar'></div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
          },
          
          // --- DATA SOURCE SECTION ---
          // Replace the events array below with your actual Zoho API Fetch logic.
          // For now, I have put "Mock Data" here so you can test the popup immediately.
          events: [
            {
              title: 'Move: John Doe',
              start: '2025-12-22T10:00:00',
              // "extendedProps" is where we store your custom Zoho fields
              extendedProps: {
                customer_name: "John Doe",
                origin_address: "2600 N Stemmons Fwy, Dallas, TX 75207",
                destination_address: "8000 Denton Hwy, Watauga, TX 76148"
              }
            },
            {
              title: 'Move: Jane Smith (Missing Dest)',
              start: '2025-12-23T14:00:00',
              extendedProps: {
                customer_name: "Jane Smith",
                origin_address: "123 Main St, Carrollton, TX",
                destination_address: "" // EMPTY to test your error logic
              }
            }
          ],

          // --- CLICK HANDLER SECTION ---
          eventClick: function(info) {
            // Prevent the browser from navigating if the event has a URL
            info.jsEvent.preventDefault(); 
            
            // 1. Extract data from the clicked event
            // We use 'info.event.extendedProps' because that is where FullCalendar stores custom data
            var props = info.event.extendedProps;
            var customer = props.customer_name || "Unknown Customer";
            var originAddr = props.origin_address || "";
            var destAddr = props.destination_address || "";

            // 2. LOGIC: Check if Destination is Missing
            if (!destAddr) {
                // A. Display Error Popup
                Swal.fire({
                    icon: 'warning',
                    title: 'Missing Address',
                    text: 'Destination address is missing for ' + customer,
                    confirmButtonText: 'Update in Zoho'
                }).then((result) => {
                    if (result.isConfirmed) {
                       // B. TODO: Trigger Zoho Update
                       // Since this is a public webpage, you cannot safely write to Zoho directly here 
                       // without exposing your API keys. 
                       // Ideally, you would open the Zoho Record in a new tab to edit it:
                       // window.open("YOUR_ZOHO_RECORD_EDIT_URL", "_blank");
                       console.log("User requested to update Zoho record.");
                    }
                });
                return; // Stop here, do not show the navigation popup
            }

            // 3. Construct Google Maps Links (Defaulting Origin to "Current Location")
            // We encodeURIComponent to ensure spaces and commas don't break the link
            var originLink = "https://www.google.com/maps/dir/?api=1&destination=" + encodeURIComponent(originAddr);
            var destLink = "https://www.google.com/maps/dir/?api=1&destination=" + encodeURIComponent(destAddr);

            // 4. Show the Success Popup
            Swal.fire({
              title: customer,
              html: `
                <div style="text-align: left; font-size: 1.1em;">
                    <p style="margin-bottom: 15px;">
                        <strong style="color:#555;">üìç Pickup (Origin):</strong><br>
                        <a href="${originLink}" target="_blank" class="popup-link">
                            ${originAddr}
                        </a> 
                    </p>
                    <hr style="border-top: 1px solid #eee; margin: 10px 0;">
                    <p>
                        <strong style="color:#555;">üèÅ Dropoff (Destination):</strong><br>
                        <a href="${destLink}" target="_blank" class="popup-link">
                            ${destAddr}
                        </a> 
                    </p>
                </div>
              `,
              icon: 'info',
              showConfirmButton: true,
              confirmButtonText: 'Close'
            });
          }
        });

        calendar.render();
      });
    </script>
  </body>
</html>
