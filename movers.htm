<html>

<head>
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>MMS INTRANET</title>
   <script src="https://unpkg.com/@descope/web-component@latest/dist/index.js"></script>
   <script src="https://unpkg.com/@descope/web-js-sdk@latest/dist/index.umd.js"></script>
   <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
   <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js" integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0=" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js" integrity="sha256-jLFv9iIrIbqKULHpqp/jmePDqi989pKXOcOht3zgRcw=" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js" integrity="sha256-jLFv9iIrIbqKULHpqp/jmePDqi989pKXOcOht3zgRcw=" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="mmsstyle.css">
   <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/smoothness/jquery-ui.css">
</head>
<script>
    

$(document).ready(foc);

function foc()
{

   $( ".cross" ).hide();
   $( ".menu" ).hide();
   $( ".hamburger" ).click(function()
   {
      $( ".menu" ).slideToggle( "fast", function()
      {
         $( ".hamburger" ).hide();
         $( ".cross" ).show();
	       $('#addmoverdialog').dialog('close');
      }
      );
   }
   );

   $( ".cross" ).click(function()
   {
      $( ".menu" ).slideToggle( "fast", function()
      {
         $( ".cross" ).hide();
         $( ".hamburger" ).show();
      }
      );
   }
   );
}

function HomeSelected()
{
   $( ".menu" ).slideToggle( "fast", function()
   {
      $( ".cross" ).hide();
      $( ".hamburger" ).show();
   }
   )
   
   $('#calendarframe').remove();
   $('#clockinframe').remove();
	  $('#addmoverframe').remove();
}


function CalendarSelected()
{
	$('#calendarframe').remove();
	$('#clockinframe').remove();
	$('#addmoverframe').remove();	
	
	
   $.LoadingOverlay("show",
   {
      imageColor : "#0C419a",
      imageAnimation : "8000ms pulse"
   }
   );
   setTimeout(function()
   {
      $.LoadingOverlay("hide");
   }
   , 2000);

   $( ".menu" ).slideToggle( "fast", function()
   {
      $( ".cross" ).hide();
      $( ".hamburger" ).show();
   }
   );
   
   const iframe0 = document.createElement("iframe");
   iframe0.style = 'border:none';
   iframe0.id = 'calendarframe';
   iframe0.width = '100%';
   iframe0.height = '800px';
   document.body.appendChild(iframe0);
   iframe0.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/report-embed/Current_Bookings/UVe6stDyTr0Ofd0v8d5YJhGDph0pBaGuBxAAXgnZSMXh6ZgYNTH7aQmQB3UR8G9hxwQ9w9wdeddG74rrA8H7V7TeWWVQtHP9jVzE";
   $('#splash').remove()

}


function MoverSelected()
{

   $( ".menu" ).slideToggle( "fast", function()
   {
      $( ".cross" ).hide();
      $( ".hamburger" ).show();
   }
   );
	 
   $('#calendarframe').remove();
   $('#clockinframe').remove();
	 $('#addmoverframe').remove();
	
	const iframe3 = document.createElement("iframe");
   iframe3.id = 'addmoverframe';
   iframe3.width = '100%';
   iframe3.height = '600px';
   iframe3.style = 'border:none';
   
   iframe3.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/Add_Mover_To_Job/K94Pj9Q02ZQxseasgKf3RRvjqk8A5rC6CREEXtMW14vx3rhJx78x8JFxuke5XTgv1RDEjXm5Qv9AY9bD0rCC6wdAfvhnRTH4GVF4";

   document.body.appendChild(iframe3);
  // $('#addmoverdialog').dialog('open');
}

function ClockIn()
{
   $( ".menu" ).slideToggle( "fast", function()
   {
      $( ".cross" ).hide();
      $( ".hamburger" ).show();
   }
   );

   $('#calendarframe').remove();
	 $('#addmoverframe').remove();
	$('#clockinframe').remove();
  
   
      $.LoadingOverlay("show",
   {
      imageColor : "#0C419a",
      imageAnimation : "8000ms pulse"
   }
   );
  
   const options =
   {
      enableHighAccuracy : true,
      timeout : 10000,
      maximumAge : 0
   }
   ;

   if (navigator.geolocation)
   {
   setTimeout(function()
   {
      $.LoadingOverlay("hide");
   }
   , 3000);
      none = navigator.geolocation.getCurrentPosition(successLocation, error, options);
   }
   else
   {
      alert("Geolocation is not supported by this browser.");
   }

}
async function successLocation(position)
{

   let response = await fetch('https://api.ipify.org/?format=json');
   let data = await response.text();
   const obj = JSON.parse(data);



   const iframe2 = document.createElement("iframe");
   iframe2.id = 'clockinframe';
   iframe2.width = '100%';
   iframe2.height = '1200px';
   iframe2.style = 'border:none';
   iframe2.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/CheckIn/8O7e3kdZNJF99mA14Gm2EgTfT5DX5YWVfr3jHy451sYFaxAdUDaudFwN86ub4fTN4qxrZHU9Ez1V5Om5zzGwq57Fs0RA9Mv8Db8j?CapturedIPAddress=" + obj.ip + "&Mover_Coordinates=" + position.coords.latitude + ", " + position.coords.longitude;

   document.body.appendChild(iframe2);
}
function error()
{
}
</script>

<body>
<p id="container"></p>
<script>
var container = document.getElementById('container');
      container.innerHTML = '<header><h3><span style="display: flex;justify-content: center;">Metroplex Moving Services<br>INTRANET</a></span></h3><button class="hamburger">&#9776;</button><button class="cross">&#735;</button> <div class="menu" id="theMenu"></div><div>User Name: <span id="userName" style="display: flex;justify-content: center;color: #0c419a">Loading your name..</span>User Role Names: <span id="userRoles" style="display: flex;justify-content: center;color: #0c419a">Loading Roles...</span></div></header>';
      const sdk = Descope({ projectId: 'P2qXQxJA4H4hvSu2AnDB5VjKnh1d', persistTokens: true, autoRefresh: true });      
      const sessionToken = sdk.getSessionToken()
      var notValidToken;

      if (!sessionToken) {
        window.location.href = "index.html";
      }else {
      notValidToken = sdk.isJwtExpired(sessionToken);
      if (notValidToken){
        window.location.href = "index.html";
      }else{
        const onSuccess = (e) => {sdk.refresh()}
      DoIt();
      CalendarSelected()
      }
      }

      async function DoIt (){
      const user =  await sdk.me(localStorage.getItem("DSR"));
      const userId = user.data.name;
      const userRole = user.data.roleNames;
      //BuildMenu(); or ...
      const theMenu = document.getElementById('theMenu');
              document.getElementById('userName').textContent = userId;
              document.getElementById('userRoles').textContent = userRole[0] + " " + userRole[1];
              theMenuInnerHTML = '<ul><a href="https://metroplex-moving-services.github.io/Intranet/"><a href="https://metroplex-moving-services.github.io/Intranet/"><li>Intranet</li></a></ul>';
              if (userRole.includes("Hoobastank")){
              theMenuInnerHTML  = theMenuInnerHTML +  '<ul><a href="https://metroplex-moving-services.github.io/Intranet/movers.htm"><li>Movers</li></a></ul>';
              theMenuInnerHTML  = theMenuInnerHTML +  '<ul><a href="javascript:CalendarSelected();"><li>Job Calendar</li></a></ul>';
              theMenuInnerHTML  = theMenuInnerHTML +  '<ul><a href="javascript:MoverSelected();"><li>Add Mover to Job</li></a></ul>';
              theMenuInnerHTML  = theMenuInnerHTML +  '<ul><a onclick="ClockIn()"><li>Clock In</li></a></ul>';
              }
              if (userRole.includes("Phish")){
              theMenuInnerHTML = theMenuInnerHTML + '<ul><a href="https://metroplex-moving-services.github.io/Intranet/ap.htm"><li>Accounts Payable</li></a><a href="javascript:CreateInvoiceSelected();"><li>Create Invoice</li></a>';
              }
              theMenu.innerHTML = theMenuInnerHTML;

}
</script>
</body>
</html>