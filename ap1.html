<!DOCTYPE html>
<html>
  <head><!-- ... --></head>
 
  <body><p id="container"></p></body>
  
</html>
 
<!-- Add below lines to all your authenticated pages -->
<script src="https://unpkg.com/@descope/web-js-sdk@latest/dist/index.umd.js"></script>
<script>
      var container = document.getElementById('container');
      container.innerHTML = '<header><h3><span style="display: flex;justify-content: center;">Metroplex Moving Services<br>INTRANET</a></span></h3><button class="hamburger">&#9776;</button><button class="cross">&#735;</button> <div class="menu" id="theMenu"></div><div><span style="display: flex;justify-content: center;color: #0c419a">Ay yo</span><span id="userName" style="display: flex;justify-content: center;color: #0c419a">Loading your name..</span><span id="userRoles" style="display: flex;justify-content: center;color: #0c419a">Loading Roles...</span></div></header><div id="imgholderdiv" style="display: flex;justify-content: center;padding-top:200px;"><img id="splash" src="https://images.squarespace-cdn.com/content/v1/5ae8afd73917ee3150d25ec8/a9dc2415-e7d7-4e32-b6dc-9f810d0edbb7/image-asset.jpeg?format=400w" width="400"></img></div>';
      const sdk = Descope({ projectId: 'P2qXQxJA4H4hvSu2AnDB5VjKnh1d', persistTokens: true, autoRefresh: true });      
      const sessionToken = sdk.getSessionToken()
      var notValidToken;

      if (!sessionToken) {
        container.innerHTML = '<descope-wc project-id="P2qXQxJA4H4hvSu2AnDB5VjKnh1d" flow-id="sign-in"></descope-wc>';
      }else {
      notValidToken = sdk.isJwtExpired(sessionToken);
      if (notValidToken){
        container.innerHTML = '<descope-wc project-id="P2qXQxJA4H4hvSu2AnDB5VjKnh1d" flow-id="sign-in"></descope-wc>';
      }else{
        const onSuccess = (e) => {sdk.refresh()}
      DoIt();

      }
      }

      async function DoIt (){
      const user =  await sdk.me(localStorage.getItem("DSR"));
      const userId = user.data.name;
      const userRole = user.data.roleNames;
      //BuildMenu(); or ...
      const theMenu = document.getElementById('theMenu');
              document.getElementById('userName').textContent = userId;
              document.getElementById('userRoles').textContent = userRole[0] + " " + userRole[1];
              theMenuInnerHTML = '<ul><a href="https://metroplex-moving-services.github.io/Intranet/"><li>Error...</li></a></ul>';
              if (userRole.includes("Hoobastank")){
              theMenuInnerHTML = '<ul><a href="https://metroplex-moving-services.github.io/Intranet/movers.htm"><li>Movers</li></a></ul>';
              }
              if (userRole.includes("Phish")){
              theMenuInnerHTML = theMenuInnerHTML + '<ul><a href="https://metroplex-moving-services.github.io/Intranet/ap.htm"><li>Accounts Payable</li></a>';
              }
              theMenu.innerHTML = theMenuInnerHTML;

}
</script>
