<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="stylesheet" href="../assets/css/mmsstyle.css">
</head>
<body class="page-profile">

<div class="container">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            
            <div class="profile-card">
                <div class="row">
                    
                    <div class="col-md-4 profile-avatar-section">
                        <div class="avatar-circle" id="avatarContainer">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="profile-name" id="dispName">Loading...</div>
                        <div class="profile-badge">Active Employee</div>
                    </div>

                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-md-12">
                                <h4 class="profile-heading">
                                    Employee Details
                                </h4>
                            </div>

                            <div class="col-md-6 detail-row">
                                <div class="detail-label"><i class="fa fa-envelope"></i> Email Address</div>
                                <div class="detail-value" id="dispEmail">-</div>
                            </div>

                            <div class="col-md-6 detail-row">
                                <div class="detail-label"><i class="fa fa-phone"></i> Phone Number</div>
                                <div class="detail-value" id="dispPhone">-</div>
                            </div>

                            <div class="col-md-6 detail-row">
                                <div class="detail-label"><i class="fa fa-id-card"></i> User Role</div>
                                <div class="detail-value" id="dispRole">-</div>
                            </div>

                            <div class="col-md-6 detail-row">
                                <div class="detail-label"><i class="fa fa-key"></i> System ID</div>
                                <div class="detail-value" id="dispId" style="font-size: 12px; color: #999;">-</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function() {
        try {
            // Access the 'user' variable from index.html (parent window)
            // This grabs the data without needing to re-fetch from the database
            var parentUser = window.parent.user;
            
            if (parentUser && parentUser.data) {
                var data = parentUser.data;
                
                // 1. POPULATE TEXT FIELDS
                $("#dispName").text(data.name || "Team Member");
                $("#dispEmail").text(data.email || "No Email on File");
                $("#dispPhone").text(data.phone || "No Phone on File");
                $("#dispRole").text(data.roleNames ? data.roleNames.join(", ") : "Standard User");
                $("#dispId").text(data.userId || "Unknown");

                // 2. PROFILE PICTURE LOGIC
                // If a picture URL exists in the data...
                if (data.picture) {
                    // Replace the default icon with the actual image
                    $("#avatarContainer").html(
                        `<img src="${data.picture}" alt="Profile" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`
                    );
                    // Make the background transparent so the photo looks clean
                    $("#avatarContainer").css("background-color", "transparent");
                } 
                
            } else {
                $("#dispName").text("Session Error");
                $(".detail-value").text("Please re-login");
            }
        } catch (e) {
            console.error("Could not load user data from parent:", e);
            $("#dispName").text("Data Error");
        }
    });
</script>

</body>
</html>
