<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/@descope/web-js-sdk@1.12.1/dist/index.umd.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
    html,body        {height:100%; margin-top:0; margin-bottom:0;}
.h_iframe iframe {width:100%; height:calc(100% - 75px);}
.h_iframe {
    height: 100%;
}
.element{
    width:100%;
    height:70px;
    background:red;
}
      </style>
  </head>
    
  <body>
    <p id="menuContainer"></p>
    <div class="h_iframe">
    <iframe id="MMSiFrame" style="border:none; frameborder="0" allowfullscreen "></iframe>
    </div>

      <script>
        menuContainer = document.getElementById("menuContainer");
        const MMSiFrame =  document.getElementById("MMSiFrame");
        const theMenue = '<nav class="navbar bg-light "><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar"><span class="icon-bar" style="background-color: #0c419a"></span><span class="icon-bar" style="background-color: #0c419a"></span><span class="icon-bar" style="background-color: #0c419a"></span></button><a class="navbar-brand" href="#">MMS INTRANET</a></div><div class="collapse navbar-collapse navbar-right" id="myNavbar"><ul class="nav navbar-nav"><li class="active"><a href="#">Home</a></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Home Stagers<span class="caret"></span></a><ul class="dropdown-menu"><li ><a href="#"><span onclick="setiFrame(\'calendar\')">Calendar</span></a></li> <li  ><a href="#"></a></li><li  ><a href="#"></a></li></ul><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Movers<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#" ><span onclick="setiFrame(\'addmovertojob\')">Add Mover to Job</span></a></li><li><a href="#" ><span onclick="setiFrame(\'calendar\')">Calendar</span></a></li><li><a href="#" >Clock-In</a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Accounts Payable <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#" ><span onclick="setiFrame(\'createinvoice\')">Create Invoice</span></a></li></ul></li><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Human Resources<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="#" >My Profile</a></li><li><a href="#" >Job Timesheets</a></li></ul></li></ul></div></div></nav>';
        menuContainer.innerHTML = theMenue;

        const sdk = Descope({ projectId: "P2qXQxJA4H4hvSu2AnDB5VjKnh1d", persistTokens: true });
    
        const sessionToken = sdk.getSessionToken()

        if ((sessionToken) && (!sdk.isJwtExpired(sessionToken))){
           //  container.innerHTML = "logged in";
          const user =  await sdk.me(localStorage.getItem("DSR"));
			const userId = user.data.name;
			const userRole = user.data.roleNames;
        } else {
         // container.html = "<a href='/Intranet/login1.html'>Login</a>";
          window.location.href="/Intranet/login1.html";
        }

        function setiFrame(purpose){

          menuContainer.innerHTML = theMenue;

          MMSiFrame.removeAttribute("src");    
          
          if (purpose == 'calendar'){
            MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/report-embed/Current_Bookings/UVe6stDyTr0Ofd0v8d5YJhGDph0pBaGuBxAAXgnZSMXh6ZgYNTH7aQmQB3UR8G9hxwQ9w9wdeddG74rrA8H7V7TeWWVQtHP9jVzE";
            MMSiFrame.height = 1200;
          }
          if (purpose == 'addmovertojob'){
		  if (userRole.includes("Hoobastank")){
            MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/Add_Mover_To_Job/K94Pj9Q02ZQxseasgKf3RRvjqk8A5rC6CREEXtMW14vx3rhJx78x8JFxuke5XTgv1RDEjXm5Qv9AY9bD0rCC6wdAfvhnRTH4GVF4";
            MMSiFrame.height = 800;
		  }
		  else{
			  alert('need permissions')
		  }
          }
          if (purpose == 'createinvoice'){
            MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/Create_Stripe_Invoice1/msx9v92BZjs4KNG3QyNAPQSQxY3uOyVaCQMtSOj942pEHzSBhaUmmwvfeDpNPttGEsh3mXGJRvwh55p5Us4hTfbbabw8hZ4ZVG95";
            MMSiFrame.height = 1200;
          }
          
        }
       
      </script>
    
  </body>
</html>
