<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/@descope/web-js-sdk@1.12.1/dist/index.umd.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js" integrity="sha256-jLFv9iIrIbqKULHpqp/jmePDqi989pKXOcOht3zgRcw=" crossorigin="anonymous"></script>
    <style>
    html,body        {height:100%; margin-top:0; margin-bottom:0;}
.h_iframe iframe {width:100%; height:calc(100% - 75px);}
.h_iframe {
    height: 100%;
}
.element{
    width:100%;
    height:70px;
    background:red;do
}
      </style>
  </head>
    
  <body>
    <p id="menuContainer"></p>
    <div class="h_iframe">
    <iframe id="MMSiFrame" style="border:none; frameborder="0" allowfullscreen "></iframe>
    </div>

      <script>
	      var user;
	      var userId;
	      var userRole;
	      var theMenuHtml;
       
        const MMSiFrame =  document.getElementById("MMSiFrame");
       
	fetch('themenu.html')
  .then(response => response.text())
  .then(html => {
    // Insert the HTML into an element
	   theMenuHtml = html;
    document.getElementById('menuContainer').innerHTML = theMenuHtml;
  });
      

        const sdk = Descope({ projectId: "P2qXQxJA4H4hvSu2AnDB5VjKnh1d", persistTokens: true });
    
        const sessionToken = sdk.getSessionToken()

        if ((sessionToken) && (!sdk.isJwtExpired(sessionToken))){
           //  container.innerHTML = "logged in";
   
        } else {
         // container.html = "<a href='/Intranet/login1.html'>Login</a>";
          window.location.href="/Intranet/login1.html";
        }
	async function DoIt (){
		$("#container").width('100%');
		 user =  await sdk.me(localStorage.getItem("DSR"));
		 userId = user.data.name;
		 userRole = user.data.roleNames;
	}

        function setiFrame(purpose){
		 $.LoadingOverlay("show",  { imageColor : "#0C419a",		      imageAnimation : "8000ms pulse"});
	      
   setTimeout(function()   {      $.LoadingOverlay("hide");}, 2000);

          menuContainer.innerHTML = theMenuHtml;

          MMSiFrame.removeAttribute("src");    
          
          if (purpose == 'calendar'){
            MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/report-embed/Current_Bookings/UVe6stDyTr0Ofd0v8d5YJhGDph0pBaGuBxAAXgnZSMXh6ZgYNTH7aQmQB3UR8G9hxwQ9w9wdeddG74rrA8H7V7TeWWVQtHP9jVzE";
            MMSiFrame.height = 1200;
          }
          if (purpose == 'addmovertojob'){
		  if (userRole.includes("Hoobastank")){
            		MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/Add_Mover_To_Job/K94Pj9Q02ZQxseasgKf3RRvjqk8A5rC6CREEXtMW14vx3rhJx78x8JFxuke5XTgv1RDEjXm5Qv9AY9bD0rCC6wdAfvhnRTH4GVF4";
            		MMSiFrame.height = 800;
		  }
		  else{
			  MMSiFrame.src = "needmoreprivileges.html";
		  }
          }
          if (purpose == 'createinvoice'){
		   if (userRole.includes("Phish")){
            		MMSiFrame.src = "https://creatorapp.zohopublic.com/information152/household-goods-moving-services/form-embed/Create_Stripe_Invoice1/msx9v92BZjs4KNG3QyNAPQSQxY3uOyVaCQMtSOj942pEHzSBhaUmmwvfeDpNPttGEsh3mXGJRvwh55p5Us4hTfbbabw8hZ4ZVG95";
            		MMSiFrame.height = 1400;
		   }
		   else{
			  MMSiFrame.src = "needmoreprivileges.html";
		   }
	  }
		if (purpose == 'empty'){
            		MMSiFrame.src = "";
		   }
		   else{
			  MMSiFrame.src = "needmoreprivileges.html";
		   }
	  }
	}
 DoIt()
       
      </script>
    
  </body>
</html>
